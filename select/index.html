<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>教师评价系统后台操作页面</title>
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
       <!--CUSTOM BASIC STYLES-->
    <link href="assets/css/basic.css" rel="stylesheet" />
    <!--CUSTOM MAIN STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
    
   
	<link rel="stylesheet" href="css/select.css" />
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	
    
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap-table.min.css" />
    
    	
    <!--from  select-->
    <script src="assets/js/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="js/AjaxRequest.js"></script>
	<script type="text/javascript" src="js/WdatePicker.js"></script>
	<script type="text/javascript" src="js/zepto.min.js"></script>
	<script src="assets/js/bootstrap.js"></script>
	
   <!-- <script src="assets/js/custom.js"></script>-->
    
    
    <script src="js/bootstrap-table.min.js"></script>
    <script src="js/bootstrap-table-zh-CN.js" type="text/javascript"></script> 
     <!-- METISMENU SCRIPTS -->
     <!-- CUSTOM SCRIPTS -->
    <script type="text/javascript" src="assets/js/wizard/jquery.steps.js"></script>
    <script src="assets/js/jquery.metisMenu.js"></script>
    <script src="assets/js/custom.js"></script>
   	
   
</head>
<body>
    <div id="wrapper">
        <nav class="navbar  navbar-cls-top " role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">翡翠教育</a>
            </div>

           <!-- <div class="header-right">
                <a href="message-task.html" class="btn btn-info" title="New Message"><b>30 </b><i class="fa fa-envelope-o fa-2x"></i></a>
                <a href="message-task.html" class="btn btn-primary" title="New Task"><b>40 </b><i class="fa fa-bars fa-2x"></i></a>
                <a href="login.html" class="btn btn-danger" title="Logout"><i class="fa fa-exclamation-circle fa-2x"></i></a>
            </div>-->
        </nav>
        <!-- 导航 -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
					<!--查询主页面的侧边栏按钮-->
                    <li>
                        <a class="active-menu" href="index.html"><i class="fa fa-dashboard "></i>查询导出</a>
                    </li>
                    <!--编辑菜单栏按钮-->
                    <li>
                        <a href="edit.html"><i class="fa fa-edit "></i>老师管理</a>
                    </li>
                    <li>
                        <a href="abnormal.html"><i class="fa fa-anchor "></i>异常数据</a>
                    </li>
                    <li>
                        <a href="dataAnalysis.html"><i class="fa fa-bar-chart-o "></i>数据分析</a>
                    </li>
                  </ul>     
             </div>

        </nav>
        <!-- 主页面  -->
               <!-- 主页面  -->
        <div id="page-wrapper">
            <div id="page-inner">
            	<!--主页面头部-->
                <div class="portlet box grey">
				    <div class="portlet-title">
					    <div class="caption"><i class="icon-user"></i>查询导出</div>
		                <div class="actions" style="display: none;">
						    <a href="#" id="btnAdd" class="btn btn-success">
						    	<i class="icon-add"></i> 
						    	新增
						    </a>
		                   <!-- <a href="#" id="btnDelete" class="btn btn-success"><i class="icon-remove"></i> 删除已选</a>-->
		                </div>
				    </div>
				    <div class="panel panel-default" style="margin-bottom:10px;">
						<div class="panel-heading">查询条件</div>
						<div class="panel-body">
							<form id="formSearch" class="form-horizontal">
								<div class="form-group" style="margin-top: 15px">
									<label class="control-label col-sm-1"
										for="txt_search_departmentname">大&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;区</label>
									<div class="col-sm-2">
										<select class="form-control" id="bigArea">
									    	<option value text="请选择">请选择</option>
									    </select> 
									</div>
									<label class="control-label col-sm-1" for="txt_search_statu">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;校</label>
									<div class="col-sm-2">
										<select class="form-control"  id="schools">
									      <option value txt="请选择">请选择</option>
									    </select>
									</div>
									<label class="control-label col-sm-1" for="txt_search_statu">专业</label>
									<div class="col-sm-2">
										<select class="form-control "  id="profession">
									      <option value >请选择</option>
									    </select>
									</div>
									<label class="control-label col-sm-1" for="txt_search_statu">角色</label>
									<div class="col-sm-2">
										 <select class="form-control "  id="role">
										    <!--<option value >请选择</option>-->
										    <option value selected>讲师</option>
										    <option value >班主任</option>
										    <option value >就业</option>
										    <option value >在线老师</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
										<!--日期-->
										<label class="control-label col-sm-1" for="startDate">起始日期</label>
										<div class="col-sm-2">
										    <input class="form-control Wdate" style="height:35px;" type="text" onclick="WdatePicker()" id="startDate" name="startDate">
										</div>
										<label class="control-label col-sm-1" for="endDate">结束日期</label>
										<div class="col-sm-2">
										    <input class="form-control Wdate" style="height:35px;" type="text"  onclick="WdatePicker()" id="endDate" name="endDate">
										</div>
										<!--查询按钮-->
										<div class="col-sm-1" style="text-align: left;">
											<button type="button"  id="searchBtn" class="btn btn-primary" style="margin-left:40px;">查询</button>
										</div>
										<div class="col-sm-1" style="text-align: left;">
											<button type="button"  id="export" class="btn btn-primary" style="display:none;" style="margin-left:50px;">导出</button>
										</div>
									</div>
							</form>
						</div>
					</div>    
					<div class="portlet-body">
					    <table id="tb_departments">
						</table>
				    </div>
			    </div>
			</div>
        </div>
    </div>
    <!--加载等待-->	 
	<div  class="modal fade" id="myModal" style="position:absolute;left:50%;top:40%;">
		<img src="assets/img/prettyPhoto/dark_rounded/loader.gif" alt="等待图标" />
	</div>
	<!--尾部-->
    <div id="footer-sec">
   	    
    	<div class="footer">
			<div class="innerContainer">
				<p style="text-align:center;">总部地址:北京市海淀区小南庄怡秀园甲一号亿德大厦10层
					电话：010-61943240</p>
				<p style="text-align:center;">Copyright © 2005-2020 北京翡翠教育科技有限公司，All
					Rights Reserved 京ICP备12036804号-23</p>
			</div>
		</div>
    </div>
<script>
	$(function(){
		//加载等待图片
		function hideModal(){
			$('#myModal').modal('hide');
		}
		function showModal(){
			$('#myModal').modal({backdrop:'static',keyboard:false});
		}
		/**页面进来之后的三个下拉框大区+校区+专业，从数据库拿来数据复制给大区**/
	    var GLOBAL = GLOBAL || {};
		//预置字符串
	    GLOBAL.selectTips= '<option value="" text="请选择">请选择</option>';
	    var url = "/SearchServer/recentServlet";
	    $.ajax({
			url: url,
	        type: "get",
			success : function(data) {
				if(data.code==200){
					GLOBAL.selectData = data.results;
					var bigAreaArray = data.results.bigarea;
					// model框中专业下拉框的赋值
					profGiveVal();
					// 查询条件上面大区赋值
					var html = GLOBAL.selectTips;
					for(var i=0;i<bigAreaArray.length;i++){
						html += '<option text="'+bigAreaArray[i].name+'"value="'+ bigAreaArray[i].schoolcode +'">'+  bigAreaArray[i].name  +'</option>'
						$("#bigArea").html(html);
						
					}
	                // 查询条件上面专业赋值
	                var html = GLOBAL.selectTips;
	                for(var i=0;i<GLOBAL.selectData.subject.length;i++){
	                    html += '<option value="'+ i +'">'+ GLOBAL.selectData.subject[i]  +'</option>';
	                    $("#profession").html(html);
	                }	
				}else{
					alert('没有数据');
				}
			},
	        error: function (XMLHttpRequest, textStatus, errorThrown) {      
	            alert("请求失败！");
	        }
	     });
	     
	    // model框中专业下拉框的赋值
	    function profGiveVal(){
			var subjects = GLOBAL.selectData.subject;
			var html = '<option text="请选择" value="" selected>请选择</option>';
			for(var i=0;i<subjects.length;i++){
				html += '<option text="'+subjects[i]+'"value="'+i+'">'+ subjects[i] +'</option>';
				$("#prof").html(html);
			}
		}
	     
	    // 查询条件出 当点击大区时，申请每个大区的所有学校的数据，并赋值给学校的下来框
		$("#bigArea").change(function(){
			var code = $("#bigArea").find('option:selected').val();
			// 查询条件上面的学校下拉框清空
			$("#schools").empty();
	        if(code == ""){
	            var html='<option value="" txt="请选择" selected>请选择</option>';
	            $("#schools").html(html);
	        }else{
	            var schools = GLOBAL.selectData.schools[code];
	            var html='<option value="" text="请选择" selected>请选择</option>';
	            for(var i=0;i<schools.length;i++){
	                //html += '<option txt="'+schools[i].sch+'"value="'+ schools[i].schID +'" text="'+ schools[i].subcode+""+'">'+  schools[i].sch  +'</option>';
	                html += '<option value="'+ schools[i].schID +'" text="'+ schools[i].sch+""+'">'+  schools[i].sch  +'</option>';
	                /**默认下来框的赋值**/
	                $("#schools").html(html);
	            }
	        }
		});
			
		// 查询按钮
		$("#searchBtn").click(function(){
			var startDate = $("#startDate").val();
			if( startDate== ""){
				alert("请输入起始日期");
				return;
			}
			var endDate = $("#endDate").val();
			if(endDate == ""){
				alert("请输入结束日期");
				return;
			}
			if( Date.parse(new Date(startDate)) > Date.parse(new Date(endDate)) ){
				alert("起始日期不能大于结束日期");
				return;
			}
			
			var conditionData = {
	    		largeArea :$("#bigArea").find('option:selected').html(),
				schName : $("#schools").find('option:selected').html(),
				cusName : $("#profession").find('option:selected').html(),
				role : $("#role").find('option:selected').html(),
					startDate : startDate,
					endDate : endDate
	        };
	 
			$.ajax({
				url: "/SearchServer/selectServlet",
				type: "post",
				data: {
					name: JSON.stringify(conditionData)
				},
				beforeSend:function (){
					showModal();
				},
				success: function(data){
					if(data.code == 200){
						if(data.selectInfo.length>0){
							$("#export").show();
						}
						$('#tb_departments').bootstrapTable('load', data.selectInfo);
						hideModal();
					}else{
						alert(data.msg);
						hideModal();
					}
				},
				error: function(err){
					alert("网络错误");
					$('#tb_departments').bootstrapTable('load', []);
					hideModal();
				}
			});
			
		});
		
		$("#export").click(function(){
			var conditionData = {
				largeArea : $("#bigArea").find('option:selected').html(),
				schName : $("#schools").find('option:selected').html(),
				cusName : $("#profession").find('option:selected').html(),
				role : $("#role").find('option:selected').html(),
				startDate : $("#startDate").val()==""?"":$("#startDate").val(),
				endDate : $("#endDate").val()==""?"":$("#endDate").val()
	        };
	        var url = "/SearchServer/ExportssServlet";
			$.ajax({
				async : false,
				method : "get",
				traditional : false,
				data : {
					name : JSON.stringify(conditionData)
				},
				url : url,
				success : function(data) {
					alert(data);
					if (data == "当前导出无结果！") {
						return;
					} else {
						//location.href = "/SearchServer/xlsx/" + data;
						location.href = 'http://tp.feicuiedu.com:8081/WebRoot/xlsx/' + data;
					}
				},
				error : function(err) {
					alert('error');
				}
			});
		})
		// 初始化table
		$('#tb_departments').bootstrapTable({
			dataType: "json",
			showRefresh: true,//刷新按钮
            showToggle: true, // 切换视图
            showColumns: true,//列选择按钮
            buttonsAlign: "left",//按钮对齐方式
		    cache: false, 	// 不缓存
		    height: 535, 	// 设置高度，会启用固定表头的特性
		    striped: true, 	// 隔行加亮
		    //是否显示分页（*） 
 			pagination: true,
 			//分页方式：client客户端分页，server服务端分页（*）
			sidePagination: "client",
			//是否显示搜索
			search: true,
			columns: [{
				field: 'large_Area',
	    		title: "大区"
			},{
	    		field: 'sch_Name',
	    		title: "校区"
	        },{
	    		field: 'tea_Name',
	    		title: "教师姓名"
	        },{
	    		field: 'role_Level',
	    		title: "角色"
	        },{
	    		field: 'cus_Name',
	    		title: "专业"
	        },{
	    		field: 'stu_Class',
	    		title: "班级"
	        },{
	    		field: 'peopleCount',
	    		title: "投票人数"
	        },{
	    		field: 'average',
	    		title: "平均分"
	        },{
	    		field: 'fill_Date',
	    		title: "月份"
	        }],
	        data: []
		});
	});
</script>

</body>
</html>
